---
title: "comparison_deforestation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{comparison_deforestation}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE, fig.width=11.693, fig.height=8.268}

library(dplyr)
library(ggplot2)



# Set up
# Load data from results.
results_lst <- system.file("extdata", "compare_methods_results", "results.rds",
                            package = "activelearning") %>% 
  readRDS()

acc_no_al <- results_lst %>%
  magrittr::extract2("no_active_learning") %>% 
    purrr::map(.f = function(x){
        return(x[["accuracy"]])
    }) %>%
    magrittr::set_names(seq_len(length(.))) %>%
    dplyr::bind_rows(.id = "experiment") %>%
    dplyr::mutate(type = "No Active Learning")

acc_egal <- results_lst %>%
  magrittr::extract2("egal") %>% 
    purrr::map(.f = function(x){
        return(x[["accuracy"]])
    }) %>%
    magrittr::set_names(seq_len(length(.))) %>%
    dplyr::bind_rows(.id = "experiment") %>%
    dplyr::mutate(type = "EGAL")

acc_rs <- results_lst %>%
  magrittr::extract2("al_rand_sampling") %>% 
    purrr::map(.f = function(x){
        return(x[["accuracy"]])
    }) %>%
    magrittr::set_names(seq_len(length(.))) %>%
    dplyr::bind_rows(.id = "experiment") %>%
    dplyr::mutate(type = "AL Random Sampling")

plot_data <-  dplyr::bind_rows(acc_no_al, acc_egal, acc_rs) %>%
    dplyr::mutate(experiment = as.integer(experiment)) %>%
    dplyr::select(type, experiment, iteration,
                  n_training, metric, class, accuracy)

n_experiments <- plot_data %>%
  dplyr::pull(experiment) %>%
  unique() %>%
  length()

n_iterations <- plot_data %>%
  dplyr::pull(iteration) %>%
  unique() %>%
  length()


plot_f1 <- plot_data %>%
    dplyr::filter(metric == "f1") %>%
    ggplot2::ggplot() +
    ggplot2::geom_boxplot(ggplot2::aes(x = n_training,
                                       y = accuracy,
                                       group = n_training)) +
    ggplot2::facet_grid(cols = dplyr::vars(type),
                        rows = dplyr::vars(class)) +
    ggplot2::labs(title = "Active learning accuracy",
                  subtitle = paste(
                      "Amazonia samples",
                      paste(n_experiments, " runs"),
                      paste(n_iterations, " iterations"),
                      sep = " - "
                  )) +
    ggplot2::xlab("Number of training samples") +
    ggplot2::ylab("F1 score")
print(plot_f1)

plot_mean_overall <- plot_data %>%
    dplyr::filter(metric %in% "accuracy") %>%
    dplyr::group_by(type, n_training, metric) %>%
    dplyr::summarize(mean_acc = mean(accuracy)) %>%
    dplyr::ungroup() %>%
    ggplot2::ggplot() +
    ggplot2::geom_path(ggplot2::aes(x = n_training,
                                    y = mean_acc,
                                    color = type)) +
    ggplot2::labs(title = "Active learning accuracy",
                  subtitle = paste(
                      "Amazonia samples",
                      paste(n_experiments, " runs"),
                      paste(n_iterations, " iterations"),
                      sep = " - "
                  )) +
    ggplot2::xlab("Number of training samples") +
    ggplot2::ylab("Mean overall accuracy")
print(plot_mean_overall)

plot_mean_pu <- plot_data %>%
    dplyr::filter(metric %in% c("f1", "prod_acc", "user_acc")) %>%
    dplyr::group_by(type, n_training, metric, class) %>%
    dplyr::summarize(mean_acc = mean(accuracy)) %>%
    dplyr::ungroup() %>%
    ggplot2::ggplot() +
    ggplot2::geom_path(ggplot2::aes(x = n_training,
                                    y = mean_acc,
                                    group = class,
                                    color = class)) +
    ggplot2::facet_grid(cols = dplyr::vars(type),
                        rows = dplyr::vars(metric)) +
    ggplot2::labs(title = "Active learning accuracy",
                  subtitle = paste(
                      "Amazonia samples",
                      paste(n_experiments, " runs"),
                      paste(n_iterations, " iterations"),
                      sep = " - "
                  )) +
    ggplot2::xlab("Number of training samples") +
    ggplot2::ylab("Mean accuracy")
print(plot_mean_pu)
